# Firebase

QvikChat provides out-of-the-box support for using Firebase Firestore as a chat history store, cache store and API key store.

To setup Firebase for use with QvikChat, you need to do two things:

1. Modify your genkit configurations that you provide to the `setupGenkit` function to include the Firebase configurations, and specify your Firebase project ID.

```typescript copy
import { setupGenkit } from "@oconva/qvikchat/genkit";

// Setup Genkit with Firebase project
setupGenkit({
  firebaseConfig: {
    projectId: "my-project-id",
  },
});
```

2. Add `GOOGLE_APPLICATION_CREDENTIALS` environment variable to your `.env` file, and point it to the path of your Firebase service account key file.

```bash copy
GOOGLE_APPLICATION_CREDENTIALS=<path-to-your-firebase-service-account-key-file>
```

For information on how to create a Firebase service account key file, refer to the [Firebase documentation](https://firebase.google.com/docs/admin/setup#initialize_the_sdk_in_non-google_environments).

If you are running QvikChat in a Google Cloud environment, you can skip this step as the service account key file is automatically provided by the Google Cloud environment.

That's it! You have successfully setup Firebase for use with QvikChat. You can now use Firebase Firestore as a chat history store, cache store and API key store.

## Initialize Firebase App

To initialize a Firebase app, you can use the `getFirebaseApp` function provided by QvikChat.

```typescript copy
import { getFirebaseApp } from "@oconva/qvikchat/integrations/firebase";

// Initialize Firebase App
const firebaseApp = getFirebaseApp();
```

When calling the `getFirebaseApp` function without passing any value for the `credential` option, it will automatically try to use the `GOOGLE_APPLICATION_CREDENTIALS` environment variable to locate the service account credentials file. So, please make sure to set the `GOOGLE_APPLICATION_CREDENTIALS` environment variable before calling the `getFirebaseApp` function without explicitly specifying the location of the service account credentials file.

You can provide additional configurations to the `getFirebaseApp` function. For example, you can specify the path to the service account credentials file and the provide project ID.

```typescript copy
import { getFirebaseApp, credential } from "@oconva/qvikchat/firebase";

// Initialize Firebase App with additional configurations
getFirebaseApp({
  credential: credential.cert("./service-account.json"),
  projectId: "your-project-id",
});
```

**Using `firebase-admin`**

You may choose to directly use the [firebase-admin](https://www.npmjs.com/package/firebase-admin) package to initialize the Firebase app.

```typescript copy
import { initializeApp, credential } from "firebase-admin";

// Initialize Firebase App (GOOGLE_APPLICATION_CREDENTIALS env var specified)
const firebaseApp = initializeApp();

// Initialize Firebase App (provide configurations)
const firebaseApp = initializeApp({
  credential: credential.cert("./service-account.json"),
  projectId: "your-project-id",
});
```

For more information on how to initialize a Firebase app when using `firebase-admin`, refer to the [Firebase documentation](https://firebase.google.com/docs/admin/setup/).

## Firestore Chat History Store

You can use Firestore as a chat history store. To do this, you need to provide the Firestore chat history store to the `ChatAgent` constructor.

```typescript copy
import { ChatAgent } from "@oconva/qvikchat/agents";
import { getFirebaseApp } from "@oconva/qvikchat/firebase";
import { FirestoreChatHistoryStore } from "@oconva/qvikchat/history";

// Initialize Firebase App
const firebaseApp = getFirebaseApp();

// Chat agent with Firestore chat history store
const chatAgent = new ChatAgent({
  enableChatHistory: true,
  chatHistoryStore: new FirestoreChatHistoryStore({
    firebaseApp: firebaseApp,
    collectionName: "chat-history",
  }),
});
```

## Firestore Cache Store

You can use Firestore as a cache store. To do this, you need to provide the Firestore cache store as the `cacheStore` to the endpoint configurations.

```typescript copy {20}
import { getFirebaseApp } from "@oconva/qvikchat/firebase";
import { FirestoreCacheStore } from "@oconva/qvikchat/cache";
import { defineChatEndpoint } from "@oconva/qvikchat/endpoints";
import { ChatAgent } from "@oconva/qvikchat/agents";

// Initialize Firebase App
const firebaseApp = getFirebaseApp();

// Initialize Firestore cache store with the firebase app and collection name
const firestoreCacheStore = new FirestoreCacheStore({
  firebaseApp: firebaseApp,
  collectionName: "cache-store",
});

// Chat endpoint with Firestore cache store
defineChatEndpoint({
  chatAgent: new ChatAgent(),
  endpoint: "chat-cached",
  enableCache: true,
  cacheStore: firestoreCacheStore,
});
```

## Firestore API Key Store

You can use Firestore as an API key store. To do this, you need to provide the Firestore API key store as the `apiKeyStore` to the endpoint configurations.

```typescript copy {20}
import { getFirebaseApp } from "@oconva/qvikchat/firebase";
import { FirestoreAPIKeyStore } from "@oconva/qvikchat/auth";
import { defineChatEndpoint } from "@oconva/qvikchat/endpoints";
import { ChatAgent } from "@oconva/qvikchat/agents";

// Initialize Firebase App
const firebaseApp = getFirebaseApp();

// Initialize Firestore API key store with the collection name
const firestoreApiKeyStore = new FirestoreAPIKeyStore({
  firebaseApp: firebaseApp,
  collectionName: "api-keys",
});

// Chat endpoint with support for authentication
defineChatEndpoint({
  chatAgent: new ChatAgent(),
  endpoint: "chat-auth",
  enableAuth: true,
  apiKeyStore: firestoreApiKeyStore,
});
```
